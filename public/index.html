<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Интернет-магазин Цветы</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="style/style.css"> <!-- Подключение файла стилей -->
</head>

<body>
    <div class="flex-container">
        <aside class="left-aside">
            <div id="current_date_time_block2">
                <div>
                    <img src="images/logo.png" alt="Логотип интернет-магазина цветов" class="logo">
                </div>
                <div id="time"></div>
            </div>
            <script type="text/javascript">
                function zero_first_format(value) {
                    if (value < 10) {
                        value = '0' + value;
                    }
                    return value;
                }

                function date_time() {
                    var current_datetime = new Date();
                    var day = zero_first_format(current_datetime.getDate());
                    var month = zero_first_format(current_datetime.getMonth() + 1);
                    var year = current_datetime.getFullYear();
                    var hours = zero_first_format(current_datetime.getHours());
                    var minutes = zero_first_format(current_datetime.getMinutes());
                    var seconds = zero_first_format(current_datetime.getSeconds());
                    return day + "." + month + "." + year + "<br>" + hours + ":" + minutes + ":" + seconds;
                }
                setInterval(function () {
                    document.getElementById('time').innerHTML = date_time();
                }, 1000);
            </script>
        </aside>

        <main>
            <header>
                <div class="header-content">
                    <div class="banner">
                        <h1 class="banner-text">Цветы онлайн</h1>
                    </div>

                    <nav class="menu">
                        <ul>
                            <li class="dropdown">
                                <a href="#">Цветы <span class="triangle"></span></a>
                                <div class="dropdown-content">
                                    <div class="column">
                                        <h3>Букеты с</h3>
                                        <a href="link1.html">Ссылка 1</a>
                                        <a href="link2.html">Ссылка 2</a>
                                        <a href="link3.html">Ссылка 3</a>
                                        <a href="link4.html">Ссылка 4</a>
                                        <a href="link5.html">Ссылка 5</a>
                                        <a href="link6.html">Ссылка 6</a>
                                        <a href="link7.html">Ссылка 7</a>
                                        <a href="link8.html">Ссылка 8</a>
                                        <a href="link9.html">Ссылка 9</a>
                                        <a href="link10.html">Ссылка 10</a>
                                    </div>
                                    <div class="column">
                                        <h3>Категории</h3>
                                        <a href="link11.html">Ссылка 11</a>
                                        <a href="link12.html">Ссылка 12</a>
                                        <a href="link13.html">Ссылка 13</a>
                                        <a href="link14.html">Ссылка 14</a>
                                        <a href="link15.html">Ссылка 15</a>
                                        <a href="link16.html">Ссылка 16</a>
                                        <a href="link17.html">Ссылка 17</a>
                                        <a href="link18.html">Ссылка 18</a>
                                        <a href="link19.html">Ссылка 19</a>
                                        <a href="link20.html">Ссылка 20</a>
                                    </div>
                                    <div class="column">
                                        <h3>Букеты кому</h3>
                                        <a href="link21.html">Ссылка 21</a>
                                        <a href="link22.html">Ссылка 22</a>
                                        <a href="link23.html">Ссылка 23</a>
                                        <a href="link24.html">Ссылка 24</a>
                                        <a href="link25.html">Ссылка 25</a>
                                        <a href="link26.html">Ссылка 26</a>
                                        <a href="link27.html">Ссылка 27</a>
                                        <a href="link28.html">Ссылка 28</a>
                                        <a href="link29.html">Ссылка 29</a>
                                        <a href="link30.html">Ссылка 30</a>
                                    </div>
                                </div>

                            </li>
                            <li class="dropdown">
                                <a href="#">Повод <span class="triangle"></span></a>
                                <div class="dropdown-content">
                                    <div class="column">
                                        <a href="#">Ссылка 1</a>
                                        <a href="#">Ссылка 2</a>
                                    </div>
                                    <div class="column">
                                        <a href="#">Ссылка 3</a>
                                        <a href="#">Ссылка 4</a>
                                    </div>
                                </div>
                            </li>
                            <li class="dropdown">
                                <a href="#">Розы <span class="triangle"></span></a>
                                <div class="dropdown-content">
                                    <div class="column">
                                        <a href="#">Ссылка 1</a>
                                        <a href="#">Ссылка 2</a>
                                    </div>
                                    <div class="column">
                                        <a href="#">Ссылка 3</a>
                                        <a href="#">Ссылка 4</a>
                                    </div>
                                </div>
                            </li>
                            <li class="dropdown">
                                <a href="#">Подарки <span class="triangle"></span></a>
                                <div class="dropdown-content">
                                    <div class="column">
                                        <a href="#">Ссылка 1</a>
                                        <a href="#">Ссылка 2</a>
                                    </div>
                                    <div class="column">
                                        <a href="#">Ссылка 3</a>
                                        <a href="#">Ссылка 4</a>
                                    </div>
                                </div>
                            </li>
                            <li>
                                <a href="flowers-in-box.html">Цветы в коробке</a>
                            </li>
                            <li>
                                <a href="flowers-in-basket.html">Цветы в корзине</a>
                            </li>
                            <li>
                                <button id="cartButton" style="background: none; border: none;">
                                    <img src="images/cart.png" alt="Корзина" style="width: 32px; height: 32px;">
                                </button>
                            </li>
                        </ul>
                    </nav>
                </div>
            </header>
            <!-- Новая область для блоков -->
            <div id="blocks-container" class="blocks-container"></div>
        </main>
        <aside class="right-aside">
            <div class="contact-info">
                <p>Москва, ул. Тверская, д. 7</p>
                <p>Телефон: +7 (495) 462-28-32</p>
            </div>
            <div class="auth-form">
                <h2>Авторизация</h2>
                <form id="loginForm" action="login.php" method="post">
                    <label for="username">Логин:</label>
                    <input type="text" id="username" name="username" required>
                    <label for="password">Пароль:</label>
                    <input type="password" id="password" name="password" required>
                    <button type="submit">Войти</button>
                </form>
                <p>Нет аккаунта? <a href="#" data-toggle="modal" data-target="#registerModal">Регистрация</a></p>
            </div>
            <div id="loginMessage"></div> <!-- Новый элемент для сообщений -->
        </aside>
        <!-- Модальное окно для регистрации -->
        <div class="modal fade" id="registerModal" tabindex="-1" role="dialog" aria-labelledby="registerModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="registerModalLabel">Регистрация</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="registerForm" action="register.php" method="post">
                            <div class="form-group">
                                <label for="first_name">Имя:</label>
                                <input type="text" class="form-control" id="first_name" name="first_name" required>
                            </div>
                            <div class="form-group">
                                <label for="last_name">Фамилия:</label>
                                <input type="text" class="form-control" id="last_name" name="last_name" required>
                            </div>
                            <div class="form-group">
                                <label for="reg-email">Email:</label>
                                <input type="email" class="form-control" id="reg-email" name="email" required>
                            </div>
                            <div class="form-group">
                                <label for="phone">Телефон:</label>
                                <input type="text" class="form-control" id="phone" name="phone">
                            </div>
                            <div class="form-group">
                                <label for="address">Адрес:</label>
                                <input type="text" class="form-control" id="address" name="address">
                            </div>
                            <div class="form-group">
                                <label for="reg-password">Пароль:</label>
                                <input type="password" class="form-control" id="reg-password" name="password" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Зарегистрироваться</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Модальное окно для добавления в корзину -->
        <div class="modal fade" id="addToCartModal" tabindex="-1" role="dialog" aria-labelledby="cartModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="cartModalLabel">Добавить в корзину</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="cartForm">
                            <div class="form-group">
                                <img id="productImage" src="" alt="Изображение товара" class="img-fluid">
                            </div>
                            <div class="form-group">
                                <label for="productName">Название:</label>
                                <p id="productName"></p>
                            </div>
                            <div class="form-group">
                                <label for="productDescription">Описание:</label>
                                <p id="productDescription"></p>
                            </div>
                            <div class="form-group">
                                <label for="productPrice">Цена:</label>
                                <p id="productPrice"></p>
                            </div>
                            <div class="form-group">
                                <label for="quantity">Количество:</label>
                                <input type="number" class="form-control" id="quantity" name="quantity" min="1"
                                    value="1" required>
                            </div>
                            <div class="form-group">
                                <label for="totalPrice">Стоимость:</label>
                                <p id="totalPrice"></p>
                            </div>
                            <button type="submit" class="btn btn-primary">Оформить</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <!-- Модальное окно для корзины -->
        <div class="modal fade" id="cartModal" tabindex="-1" role="dialog" aria-labelledby="cartModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="cartModalLabel">Корзина</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div class="modal-body" id="cartContent">
                        <!-- Содержимое корзины будет загружено сюда -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
                        <!--<button type="button" class="btn btn-primary" id="checkoutButton">Оплатить</button>-->
                    </div>
                </div>
            </div>
        </div>


        <script>

            document.getElementById('registerForm').addEventListener('submit', function (event) {
                event.preventDefault(); // Предотвращаем стандартное поведение формы

                var formData = new FormData(this);

                fetch('register.php', {
                    method: 'POST',
                    body: formData
                })
                    .then(response => response.text())
                    .then(data => {
                        document.querySelector('.modal-body').innerHTML = '<p>' + data + '</p>';
                    })
                    .catch(error => console.error('Ошибка:', error));
            });

            document.getElementById('loginForm').addEventListener('submit', function (event) {
                event.preventDefault(); // Предотвращаем стандартное поведение формы

                var formData = new FormData(this);

                fetch('login.php', {
                    method: 'POST',
                    body: formData
                })
                    .then(response => response.text())
                    .then(data => {
                        document.getElementById('loginMessage').innerHTML = '<p>' + data + '</p>';
                    })
                    .catch(error => console.error('Ошибка:', error));
            });

            document.addEventListener("DOMContentLoaded", function () {
                fetch('load_images.php')
                    .then(response => response.json())
                    .then(data => {
                        const container = document.getElementById('blocks-container');
                        container.innerHTML = ''; // Очистка контейнера

                        data.forEach(item => {
                            const block = document.createElement('div');
                            block.className = 'block';
                            block.innerHTML = `
<img src="images/Flowers/${item.image}" alt="${item.name}">
<p>Название: ${item.name}<br>
Описание: ${item.description}<br>
Цена: ${item.price}</p>
<button class="add-to-cart" data-flower-id="${item.flower_id}" data-name="${item.name}" data-description="${item.description}" data-price="${item.price}" data-image="${item.image}">
<img src="images/cart.png" alt="Добавить в корзину">
</button>`;
                            container.appendChild(block);
                        });
                        // Обработчик клика по кнопке "Добавить в корзину"
                        document.querySelectorAll('.add-to-cart').forEach(button => {
                            button.addEventListener('click', function () {

                                // Проверка, что пользователь вошел в систему
                                fetch('check_session.php')
                                    .then(response => response.json())
                                    .then(data => {
                                        if (!data.loggedIn) {
                                            alert('Пожалуйста, войдите в систему, чтобы добавить товар в корзину.');
                                            return;
                                        }

                                        const flowerId = this.getAttribute('data-flower-id');
                                        const productName = this.getAttribute('data-name');
                                        const productDescription = this.getAttribute('data-description');
                                        const productPrice = this.getAttribute('data-price');
                                        const productImage = this.getAttribute('data-image');
                                        document.getElementById('quantity').value = 1;

                                        document.getElementById('productImage').src = `images/Flowers/${productImage}`;
                                        document.getElementById('productName').textContent = productName;
                                        document.getElementById('productDescription').textContent = productDescription;
                                        document.getElementById('productPrice').textContent = productPrice;
                                        document.getElementById('totalPrice').textContent = productPrice;

                                        $('#addToCartModal').modal('show');

                                        document.getElementById('quantity').addEventListener('input', function () {
                                            const quantity = this.value;
                                            const totalPrice = quantity * productPrice;
                                            document.getElementById('totalPrice').textContent = totalPrice;
                                        });
                                    });
                            });
                        });
                    });
            });

            document.addEventListener('DOMContentLoaded', function () {
                document.getElementById('cartForm').addEventListener('submit', function (event) {
                    event.preventDefault();
                    const flowerId = document.querySelector('.add-to-cart[data-flower-id]').getAttribute('data-flower-id');
                    const productPrice = document.querySelector('.add-to-cart[data-flower-id]').getAttribute('data-price');
                    const quantity = document.getElementById('quantity').value;
                    const totalPrice = quantity * productPrice;

                    fetch('add_to_cart.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: `flower_id=${flowerId}&quantity=${quantity}&total_price=${totalPrice}`
                    })
                        .then(response => response.text())
                        .then(data => {
                            alert(data); // Выводим сообщение об успешном добавлении
                            $('#addToCartModal').modal('hide');
                        })
                        .catch(error => console.error('Ошибка:', error));
                });
            });

            document.getElementById('cartButton').addEventListener('click', function (event) {
                event.preventDefault(); // Предотвращаем стандартное поведение кнопки

                fetch('cart.php')
                    .then(response => response.text())
                    .then(data => {
                        document.getElementById('cartContent').innerHTML = data;
                        $('#cartModal').modal('show'); // Показываем модальное окно
                    })
                    .catch(error => console.error('Ошибка:', error));
            });
        </script>
</body>

</html>